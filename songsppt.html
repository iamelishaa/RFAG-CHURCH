<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Songs PPT</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #searchBox {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            font-size: 16px;
        }
        .result-item {
            padding: 10px;
            margin: 5px 0;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            cursor: pointer;
        }
        .result-item:hover {
            background-color: #f0f0f0;
        }
        iframe {
            width: 100%;
            height: 600px;
            margin-top: 20px;
            border: none;
        }
        #pptViewer {
            max-width: 100%;
            height: 600px;
            margin-top: 20px;
            display: none;
        }
        #navigationBtns {
            margin-top: 10px;
        }
        #prevBtn, #nextBtn {
            padding: 10px 20px;
            background-color: #28a745;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        #prevBtn:hover, #nextBtn:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <h1>RFAG PPT Search</h1>
    <input type="text" id="searchBox" placeholder="Search for a song...">
    <div id="results"></div>

    <!-- Google Slides Embed (You can replace this with your own link) -->
    <div id="googleSlidesViewer" style="display: none;">
        <iframe id="googleSlidesIframe" src="" allowfullscreen="true"></iframe>
    </div>

    <!-- Placeholder for displaying slides -->
    <div id="pptViewer">
        <img id="slideImage" src="" alt="Slide" style="width: 100%; max-height: 100%;">
    </div>

    <!-- Navigation buttons -->
    <div id="navigationBtns" style="display: none;">
        <button id="prevBtn">Previous Slide</button>
        <button id="nextBtn">Next Slide</button>
    </div>

    <script>
        const searchBox = document.getElementById("searchBox");
        const resultsDiv = document.getElementById("results");
        const pptViewer = document.getElementById("pptViewer");
        const slideImage = document.getElementById("slideImage");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const googleSlidesViewer = document.getElementById("googleSlidesViewer");
        const googleSlidesIframe = document.getElementById("googleSlidesIframe");

        let songs = [];
        let currentSlide = 0;
        let slideImages = [];

        // Fetch songs metadata
        fetch("songs.json")
            .then(response => response.json())
            .then(data => {
                songs = data;
            })
            .catch(error => console.error("Error loading songs:", error));

        // Display search results
        const renderResults = (filteredSongs) => {
            resultsDiv.innerHTML = ""; // Clear previous results
            pptViewer.style.display = "none"; // Hide the viewer
            googleSlidesViewer.style.display = "none"; // Hide Google Slides viewer
            navigationBtns.style.display = "none"; // Hide navigation buttons

            if (filteredSongs.length === 0) {
                resultsDiv.innerHTML = "<p>No results found.</p>";
                return;
            }

            filteredSongs.forEach(song => {
                const item = document.createElement("div");
                item.className = "result-item";
                item.textContent = song.title;
                item.addEventListener("click", () => {
                    if (song.isGoogleSlides) {
                        // If the song is a Google Slides presentation
                        loadGoogleSlides(song);
                    } else {
                        // If the song is a PPTX or image-based
                        loadSlidesForSong(song);
                    }
                });
                resultsDiv.appendChild(item);
            });
        };

        // Load Google Slides
        const loadGoogleSlides = (song) => {
            googleSlidesIframe.src = `https://docs.google.com/presentation/d/${song.fileId}/embed?start=false&loop=false&delayms=3000`;
            googleSlidesViewer.style.display = "block"; // Show Google Slides viewer
        };

        // Load slides for a specific song (image-based)
    const loadSlidesForSong = (song) => {
        slideImages = [];
        let totalSlides = song.totalSlides; // Assuming each song metadata contains the number of slides

        for (let i = 1; i <= totalSlides; i++) {
            // Use a template literal to construct the slide image URL
            slideImages.push(`${song.basePath}/${song.fileId}_slide${i}.jpg`);
        }

        // Show the first slide
        currentSlide = 0;
        showSlide(currentSlide);

        pptViewer.style.display = "block"; // Show the slide viewer
        navigationBtns.style.display = "block"; // Show navigation buttons
    };

    // Show the current slide
    const showSlide = (index) => {
            if (index >= 0 && index < slideImages.length) {
                slideImage.src = slideImages[index];
            }
        };

        // Previous Slide functionality
        prevBtn.addEventListener("click", () => {
            if (currentSlide > 0) {
                currentSlide--;
                showSlide(currentSlide);
            }
        });

        // Next Slide functionality
        nextBtn.addEventListener("click", () => {
            if (currentSlide < slideImages.length - 1) {
                currentSlide++;
                showSlide(currentSlide);
            }
        });

        // Search functionality
        searchBox.addEventListener("input", () => {
            const query = searchBox.value.toLowerCase().trim();
            if (!query) {
                resultsDiv.innerHTML = "";
                pptViewer.style.display = "none";
                googleSlidesViewer.style.display = "none";
                navigationBtns.style.display = "none";
                return;
            }

            const filteredSongs = songs.filter(song =>
                song.title.toLowerCase().includes(query) || 
                song.description.toLowerCase().includes(query)
            );

            renderResults(filteredSongs);
        });
</script>
</body>
</html>

