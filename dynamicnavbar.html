<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />  
    <title>Sermons | RFAG Church</title>
    <link rel="stylesheet" href="css/dynamicnavbar.css">
    <link rel="shortcut icon" href="images/16.png" type="image/x-icon">
</head>
<body>

    <nav class="navbar">
        <div class="logo">
            <img src="./images/120.png" alt="Logo"> <!-- Logo with rounded corners -->
        </div>
        <div class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <ul id="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="dynamicnavbar.html">Sermons</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="online.html">Online</a></li>
            <li><a href="giving.html">Giving</a></li>
        </ul>
    </nav>
    <div class="container">
        <!-- Sermon Header -->
        <h1 class="sermon-title">Sermon</h1>
    
        <!-- Featured Video -->
        <div class="featured-video">
            <iframe 
                id="featured-video"
                src="https://www.youtube.com/embed/wREIW1CFJyg" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
            </iframe>
        </div>
    
        <!-- Popular Sermons Header -->
        <h2 class="popular-sermons-title">Recent Sermons</h2>
    
        <!-- Carousel with Navigation -->
        <div class="carousel-container">
            <button class="carousel-btn left-btn" id="prevBtn">&#10094;</button>
            <div class="carousel" id="carousel">
                <!-- Carousel items will be dynamically injected here -->
            </div>
            <button class="carousel-btn right-btn" id="nextBtn">&#10095;</button>
        </div>
    </div>

    <script>
        const API_KEYS = [
            'AIzaSyAf_zqsjoEIG7Wksrko5qj5C7pxg4n5R70',  // API keys
            'AIzaSyDLFdsSN9_v-zRZCsNH0hfFxyMw3aOe6qM',  
            'AIzaSyDMTXBQ7sfGi4AE8PxdbwOQ-FSKbwwmxIc',  
            'AIzaSyCT-z6sflyUCNWuZ-hgWymtpZFqOioksYE',  
            'AIzaSyA-IxduYTFzO_ytnWBQEMm-KEPyH-szyfU',  
            'AIzaSyCrJ1LGrmqPwvapuZSHLaLagIYjRoJFZzA',  
            'AIzaSyBR-X3AgiTdc9l5rquxLc-Ttk_92IqEKNA'  
        ];
        const CHANNEL_ID = 'UCfGHCtW5XlkY78l97_Rwu4Q'; // channel ID
        const MAX_RESULTS = 10; // Number of videos to fetch
        const carousel = document.getElementById('carousel');
        const featuredVideo = document.getElementById('featured-video');
        
        let currentIndex = 0;
        let currentAPIKeyIndex = 0; // Track current API key index

        // Function to check the remaining API quota
        async function checkQuota(apiKey) {
            const response = await fetch(`https://www.googleapis.com/youtube/v3/videos?key=${apiKey}`);
            const data = await response.json();
            if (data.error) {
                // Check the error for quota limits and handle key rotation
                if (data.error.code === 403) {
                    console.warn("API quota exceeded for the current key.");
                    rotateAPIKey(); // Switch to the next API key
                    return false;
                }
            }
            return true;
        }

        // Rotate API Key (switch to the next available API key)
        function rotateAPIKey() {
            currentAPIKeyIndex = (currentAPIKeyIndex + 1) % API_KEYS.length;
            console.log(`Switched to API key: ${API_KEYS[currentAPIKeyIndex]}`);
        }

        // Function to fetch videos from the YouTube Data API
        async function fetchVideos() {
            // Check if the API quota is still valid before making the request
            const isQuotaValid = await checkQuota(API_KEYS[currentAPIKeyIndex]);
            if (!isQuotaValid) return; // Stop if the quota is exceeded

            try {
                // First, check if we have cached data in localStorage
                const cachedData = localStorage.getItem('youtubeVideos');
                if (cachedData) {
                    console.log('Using cached data');
                    const data = JSON.parse(cachedData);
                    populateCarousel(data);
                    return;
                }

                // Fetch videos from YouTube Data API
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?key=${API_KEYS[currentAPIKeyIndex]}&channelId=${CHANNEL_ID}&part=snippet&type=video&order=date&maxResults=${MAX_RESULTS}`
                );
                const data = await response.json();

                // Cache the response in localStorage
                localStorage.setItem('youtubeVideos', JSON.stringify(data));
                populateCarousel(data);
            } catch (error) {
                console.error('Error fetching videos:', error);
            }
        }

        // Populate the carousel with video data
        function populateCarousel(data) {
            data.items.forEach((video, index) => {
                const videoId = video.id.videoId;
                const thumbnail = video.snippet.thumbnails.medium.url;
                const title = video.snippet.title;

                // Create carousel item
                const item = document.createElement('div');
                item.classList.add('carousel-item');
                item.innerHTML = `
                    <img src="${thumbnail}" alt="${title}" data-video-id="${videoId}">
                    <p>${title}</p>
                `;

                // Add click event to change the featured video and enable autoplay
                item.addEventListener('click', () => {
                    featuredVideo.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`; // Enable autoplay
                });

                carousel.appendChild(item);

                // Set the first video as the featured video
                if (index === 0) {
                    featuredVideo.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`; // Set autoplay for the first video
                }
            });
        }

        // Carousel Navigation
        const items = [];
        function updateCarousel() {
            const itemWidth = items[0].clientWidth + 16; // Include gap
            carousel.style.transform = `translateX(-${currentIndex * itemWidth}px)`;
        }

        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentIndex < items.length - 3) {
                currentIndex++;
            } else {
                currentIndex = 0;
            }
            updateCarousel();
        });

        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentIndex > 0) {
                currentIndex--;
            } else {
                currentIndex = items.length - 3;
            }
            updateCarousel();
        });

        // Initialize
        fetchVideos().then(() => {
            items.push(...carousel.querySelectorAll('.carousel-item'));
            updateCarousel();
        });

    </script>

<footer class="footer">
    <div class="footer-content">
        <div class="footer-links">
            <div class="footer-section">
                <h3>About</h3>
                <ul>
                    <li><a href="mission.html">Our Mission</a></li>
                    <li><a href="leadership.html">Leadership</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Media</h3>
                <ul>
                    <li><a href="sermons.html">Sermons</a></li>
                    <li><a href="online.html">Watch Online</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Ministries</h3>
                <ul>
                    <li><a href="#children">Children's Ministry</a></li>
                    <li><a href="#youth">Youth Group</a></li>
                    <li><a href="#outreach">Outreach Program</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Personal</h3>
                <ul>
                    <li><a href="#contact">Contact Us</a></li>
                    <li><a href="#terms">Terms of Service</a></li>
                    <li><a href="#privacy">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
        <hr class="footer-divider">
        <div class="footer-social">
            <div class="footer-address">
                <p>123 Rhema St, Cityville, ST 12345 | 12345-12345</p>
            </div>
            <div class="social-links">
                <a href="#" aria-label="Facebook" class="facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="#" aria-label="Twitter" class="twitter"><i class="fab fa-twitter"></i></a>
                <a href="#" aria-label="Instagram" class="instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" aria-label="YouTube" class="youtube"><i class="fab fa-youtube"></i></a>
            </div>
        </div>
        <p>Â© 2024 Rhema Faith AG Church. All Rights Reserved.</p>
    </div>
</footer>
</body>
</html>
