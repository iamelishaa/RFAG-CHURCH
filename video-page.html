<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />  
  <title>Watch Video</title>
  <style>
  body {
    font-family: 'Poppins', sans-serif;
    background-color: #000;
    color: white;
    margin: 0;
    padding: 0;
  }

  .main-container {
    width: 70%;
    margin: 20px auto;
    text-align: center;
  
    padding: 20px;
    border-radius: 10px;
  }

  iframe {
    width: 100%;
    height:630px;
    border: none;
    border-radius: 10px;
  }

  .video-details-container {
    margin-top: 20px;
  }

  .video-title {
    font-size: 24px;
    font-weight: bold;
    text-align: left;
    margin-bottom: 10px;
  }

  .video-date {
    font-size: 16px;
    color: #888;
    text-align: left;
    margin-bottom: 20px;
  }

  .buttons-container {
    display: flex;
    justify-content: center;
    gap: 30px;
  }

  .button {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    color: white;
    background: none;
    border: none;
    cursor: pointer;
  }

  .button i {
    font-size: 24px;
    margin-bottom: 8px;
  }

  .button span {
    font-size: 14px;
    font-weight: 600;
  }

  .suggested-container {
    width: 100%;
    margin: 20px auto;
    text-align: left;
    background-color: #1a1a1a;
    padding: 20px;
    border-radius: 10px;
  }

  .suggested-heading {
    font-size: 22px;
    margin-bottom: 20px;
    margin-left: 14.333%;
  }

  .suggested-videos {
    display: flex;
    gap: 50px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .video-card {
    display: flex;
    flex-direction: column;
    text-decoration: none;
    color: white;
    width: 20%;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .video-card img {
    width: 100%;
    border-radius: 10px;
    transition: transform 0.3s ease;
  }

  .video-card .video-title {
    font-size: 16px;
    margin-top: 10px;
    text-align: center;
  }

  .video-card:hover {
    transform: scale(1.05);
   
  }

  .video-card:hover img {
    transform: scale(1.05);
  }
</style>


  </style>
</head>
<body>
    <div class="main-container">
        <iframe id="video-player" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        <div class="video-details-container">
          <div id="video-title" class="video-title"></div>
          <div id="video-date" class="video-date"></div>
          <div class="buttons-container">
            <a href="https://www.youtube.com/channel/UCXXXXXX" target="_blank" class="button">
              <i class="fa-brands fa-square-youtube"></i>
              <span>Follow Us</span>
            </a>
            <button class="button share" id="share-button">
              <i class="fa-solid fa-paper-plane"></i>
              <span>Share</span>
            </button>
          </div>
        </div>
      </div>
      
      <div class="suggested-container">
        <h2 class="suggested-heading">Suggested for You</h2>
        <div class="suggested-videos">
          <a href="https://www.youtube.com/watch?v=WtYjVumZ8R4" target="_blank" class="video-card">
            <img src="https://img.youtube.com/vi/WtYjVumZ8R4/hqdefault.jpg" alt="Video 1">
            <span class="video-title">GUEST SPEAKER.PRAKASH HALMIDI</span>
          </a>
          <a href="https://www.youtube.com/watch?v=yzTxMKnzY0U" target="_blank" class="video-card">
            <img src="https://img.youtube.com/vi/yzTxMKnzY0U/hqdefault.jpg" alt="Video 2">
            <span class="video-title">PROPHETIC HEALING WITH DR. RAJAMANI PAPAIAH</span>
          </a>
          <a href="https://www.youtube.com/watch?v=ammcZ-5zZhg" target="_blank" class="video-card">
            <img src="https://img.youtube.com/vi/ammcZ-5zZhg/hqdefault.jpg" alt="Video 3">
            <span class="video-title">SUNDAY SERVICE WITH REV.DR.BABU DAYANAND</span>
          </a>
        </div>
      </div>
      
  <script>
    const API_KEYS = [
      'API_KEY_1', // Replace with your first YouTube API key
      'API_KEY_2', // Replace with your second YouTube API key
      'API_KEY_3'  // Add more keys if needed
    ];
    let apiKeyIndex = 0;

    function getQueryParameter(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    // Function to truncate the video title if it's too long
    function truncateTitle(title, maxLength = 50) {
      if (title.length > maxLength) {
        return title.substring(0, maxLength) + '...'; // Truncate and add ellipsis
      }
      return title;
    }

    async function fetchVideoDetails(videoId) {
      // Check if the video details are cached
      const cachedData = localStorage.getItem(`video-${videoId}`);
      if (cachedData) {
        const videoData = JSON.parse(cachedData);
        displayVideoDetails(videoData);
        return; // Skip API call if data is cached
      }

      try {
        const apiKey = API_KEYS[apiKeyIndex];
        const response = await fetch(`https://www.googleapis.com/youtube/v3/videos?key=${apiKey}&id=${videoId}&part=snippet`);
        
        if (response.ok) {
          const data = await response.json();
          if (data.items && data.items.length > 0) {
            const video = data.items[0];
            const title = video.snippet.title;
            const truncatedTitle = truncateTitle(title);

            // Format the publish date with month in words
            const publishDate = new Date(video.snippet.publishedAt);
            const formattedDate = `${publishDate.getDate()} ${publishDate.toLocaleString('default', { month: 'long' })} ${publishDate.getFullYear()}`;

            const videoData = {
              title: truncatedTitle,
              publishDate: formattedDate,
            };

            // Cache the result in localStorage
            localStorage.setItem(`video-${videoId}`, JSON.stringify(videoData));

            // Display video details
            displayVideoDetails(videoData);

            // Set the page title to the video title
            document.title = truncatedTitle;
          } else {
            handleApiError('Video not found.');
          }
        } else {
          throw new Error('API quota exceeded.');
        }
      } catch (error) {
        console.error('Error fetching video details:', error);

        // Cycle to the next API key and retry
        apiKeyIndex = (apiKeyIndex + 1) % API_KEYS.length;
        if (apiKeyIndex !== 0) {
          console.log('Retrying with next API key...');
          fetchVideoDetails(videoId); // Retry with next key
        } else {
          handleApiError('All API keys have exceeded their quota.');
        }
      }
    }

    // Function to display video title and date
    function displayVideoDetails(videoData) {
      document.getElementById('video-title').innerText = videoData.title;
      document.getElementById('video-date').innerText = `Rev R Prabhu â€¢ ${videoData.publishDate}`;
    }

    function handleApiError(message) {
      document.getElementById('video-title').innerText = 'Error fetching title.';
      document.getElementById('video-date').innerText = message;
      document.title = 'Error fetching video details';
    }

    // Handle share button click
    document.getElementById('share-button').addEventListener('click', () => {
      const videoId = getQueryParameter('videoId');
      if (navigator.share) {
        navigator.share({
          title: document.title,
          url: `https://www.youtube.com/watch?v=${videoId}`
        }).catch(error => console.error('Error sharing:', error));
      } else {
        alert('Sharing is not supported on this browser.');
      }
    });

    const videoId = getQueryParameter('videoId');
    if (videoId) {
      const iframe = document.getElementById('video-player');
      iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1&modestbranding=1`;
      fetchVideoDetails(videoId);
    } else {
      document.body.innerHTML = '<p style="color: white;">Video not found.</p>';
      document.title = 'Video not found';
    }
  </script>
</body>
</html>
